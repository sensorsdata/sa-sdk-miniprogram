var h5Linker={is_ready:!1},log=console&&console.log||function(){};h5Linker.getSasdkValue=function(){var i=this.store.getDistinctId()||"",t=this.store.getFirstId()||"";return this._.urlSafeBase64&&this._.urlSafeBase64.encode?i=i?this._.urlSafeBase64.trim(this._.urlSafeBase64.encode(this._.base64Encode(i))):"":this._.rot13obfs&&(i=i?this._.rot13obfs(i):""),encodeURIComponent(t?"f"+i:"d"+i)},h5Linker.rewriteUrl=function(i,t){if(!this.is_ready)return this.log("h5Linker plugin not initialized"),i;var e=this,s=/([^?#]+)(\?[^#]*)?(#.*)?/.exec(i),n="";if(!s)return i;var r,o=s[1]||"",a=s[2]||"",h=s[3]||"",l="_sasdk="+this.getSasdkValue(),u=function(i){var t=i.split("&"),s=[];return e._.each(t,function(i){i.indexOf("_sasdk=")>-1?s.push(l):s.push(i)}),s.join("&")};(t=!!this._.isBoolean(t)&&t)?(r=h.indexOf("_sasdk"),n=h.indexOf("?")>-1?r>-1?o+a+"#"+h.substring(1,r)+u(h.substring(r,h.length)):o+a+h+"&"+l:o+a+"#"+h.substring(1)+"?"+l):(r=a.indexOf("_sasdk"),n=/^\?(\w)+/.test(a)?r>-1?o+"?"+u(a.substring(1))+h:o+a+"&"+l+h:o+"?"+l+h);return n},h5Linker.init=function(i){i?(this._=i._,this.store=i.store,this.log=i._.logger.info||log,this.is_ready=!0):log("H5Linker plugin initialization failed")},h5Linker.name="H5Linker",h5Linker.addDistinctIdToUrl=function(i,t){return this.is_ready?this._.isString(i)&&""!==i&&/^http(s)?:\/\//.test(i)?h5Linker.rewriteUrl(i,t):(this.log("error: URL format error"),i):(this.log("H5Linker plugin not initialized"),i)};export default h5Linker;