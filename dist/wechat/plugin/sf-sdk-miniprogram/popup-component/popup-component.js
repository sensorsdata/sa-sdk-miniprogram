var sensors=getApp().sensors;Component({options:{multipleSlots:!0},lifetimes:{attached:function(){sensors&&sensors.popupEmitter&&sensors.popupEmitter.attached&&"[object Function]"===Object.prototype.toString.call(sensors.popupEmitter.attached)&&sensors.popupEmitter.attached()}},properties:{},data:{flag:!0,isShow:!1,template:{},image_list:[],plan_obj:{}},methods:{loadImage:function(t){if(t&&t.length>0){var e=[].concat(this.image_list,t);this.setData({image_list:e})}},handle:function(t){return!!this.data.flag&&(t.popupTree||t.popupTree.properties?(this.setData({plan_obj:t}),this.setData({template:t.popupTree}),void(this.data.flag&&(this.setData({isShow:!0}),this.showPopup()))):(this.popupFail(1001),!1))},popupFail(t){var e={$sf_succeed:!1};e.fail_code=t,e.$sf_fail_reason={1000:"图片加载失败",1001:"预览信息解析失败，请检查计划配置",2000:"对照组"}[t];var s=this.data.plan_obj;s.props=e,2e3!==t&&sensors.events.emit("popup_load_fail",s),sensors.events.emit("popup_end",this.data.plan_obj)},clickMask:function(){var t=this.data.template.properties,e={};e.$sf_msg_action_id=t.maskActionId,e.$sf_close_type="POPUP_CLOSE_MASK",e.$sf_msg_element_type="mask",e.$sf_msg_element_action="close";var s=this.data.plan_obj;if(s.props=e,t&&t.maskAction){var a=t.maskAction.MINIPROGRAM,o=sensors._.isArray(a)&&a[0];if(sensors._.isObject(o))switch(e.$sf_msg_action_id=o.id||"",e.$sf_close_type=o.$sf_close_type||"",e.$sf_msg_element_action=o.type||"",o.type){case"copy":sensors.events.emit("popup_click",s);break;case"customize":case"openlink":sensors.events.emit("popup_click",s),o.closeable&&this.hidePopup();break;case"close":o.closeable&&(sensors.events.emit("popup_click",s),this.hidePopup())}}else t&&t.maskCloseEnabled&&(sensors.events.emit("popup_click",s),this.hidePopup())},hidePopup:function(){this.setData({flag:!0}),this.setData({isShow:!1}),sensors.events.emit("popup_end",this.data.plan_obj)},showPopup(){this.setData({flag:!1});var t=this.data.plan_obj;sensors.events.emit("popup_display",t)},tapContent(){console.log("点击了弹窗窗体")},topCloseButton(){var t=this.data.template.image_button;t.$sf_close_type||(t.$sf_close_type="POPUP_CLOSE_TOPRIGHT"),this.popupCLick(t)},buttomCloseButton(){var t=this.data.template.image_button;t.$sf_close_type||(t.$sf_close_type="POPUP_CLOSE_BOTTOM"),this.popupCLick(t)},clickImage(){var t=this.data.template.img;t.$sf_close_type||(t.$sf_close_type="POPUP_CLOSE_BUTTON"),this.popupCLick(t)},buttonFirst(){var t=this.data.template.button[0];"close"!==t.action_type||t.$sf_close_type||(t.$sf_close_type="POPUP_CLOSE_BUTTON"),this.popupCLick(t)},buttonSecond(){var t=this.data.template.button[1];"close"!==t.action_type||t.$sf_close_type||(t.$sf_close_type="POPUP_CLOSE_BUTTON"),this.popupCLick(t)},popupCLick(t){var e={};switch(e.$sf_msg_element_type=t.type,e.$sf_msg_element_content=t.innerText,e.$sf_msg_action_id=t.id,e.action_value=t.value,e.$sf_msg_element_action=t.action_type,e.$sf_close_type=t.$sf_close_type,t.action_type){case"copy":wx.setClipboardData({data:t.value,success(t){console.log("复制文本成功")}});break;case"navigateTo":var s={path:t.path};e.action_value=t.path,this.navigatePage(s);break;case"navigateToMiniProgram":s={path:t.path,appid:t.appid};this.navigateMini(s)}var a=this.data.plan_obj;a.props=e,sensors.events.emit("popup_click",a),t.closeable&&this.hidePopup()},navigatePage(t){wx.navigateTo({url:t.path,success:function(){console.log("navigate success")},fail:function(t){console.log("navigate fail: ",t)}})},navigateMini(t){wx.navigateToMiniProgram({appId:t.appid,path:t.path,success(){console.log("navigate success")},fail(t){console.log("navigate fail： ",t)}})}}});