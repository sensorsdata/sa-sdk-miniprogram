# 微信小程序增加 gzip 数据压缩

## 功能
对发送的数据先进行 gzip 压缩。

## 集成
```javascript
import gzip from 'dist/wechat/plugin/gzip/index.esm';
sensors.use(gzip);

sensors.init({
  ...
  batch_send:{
    send_timeout: 15000,
    max_length: 15
  }
})

```

## ⚠ 注意
* 使用了这个插件后，单条发送和批量发送，都会先进行 gzip。但是单条配置 gzip 不但减小不了多少体积，反而影响性能。所以不要在单条模式下使用这个插件，建议在默认的批量发送模式下使用。
* gzip 有少许性能影响。实测在开发者工具如果一次发送 3 条数据，做了 gzip 比没有 gzip 会多个 5-10 ms。但是如果 20 条数据以上，差距不稳定，有没有 gzip 可能都在 10-20 ms 左右的耗时。
* gzip 的压缩率跟单次发送的数据条数有关。如果一次发送 3 条类似的数据（例如发送全埋点的冷启动、热启动、页面浏览），压缩后的总字符串是没压缩总字符串的大约 30%。所以只要条数超过  3 条，压缩都会有明显的效果。数据越多效果越好。
* 总结：单次发送的数据条数越多，就越适合用 gzip ( 压缩效果、性能都有优势 ) 。建议手动修改批量发送的配置为 15 秒发送一次或者超过 15 条再发送（参考上面代码示例中的配置）。不要使用默认配置的 6 秒或者 6 条 发送。