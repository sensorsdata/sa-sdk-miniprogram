"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty;function extend(t){return each(Array.prototype.slice.call(arguments,1),function(e){for(var r in e)void 0!==e[r]&&(t[r]=e[r])}),t}function each(t,e,r){var a=Array.prototype.forEach,i={};if(null==t)return!1;if(a&&t.forEach===a)t.forEach(e,r);else if(t.length===+t.length){for(var s=0,n=t.length;s<n;s++)if(s in t&&e.call(r,t[s],s,t)===i)return!1}else for(var o in t)if(hasOwnProperty.call(t,o)&&e.call(r,t[o],o,t)===i)return!1}function filter(t,e,r){if(t.filter)return t.filter(e);for(var a=[],i=0;i<t.length;i++)if(hasOwnProperty.call(t,i)){var s=t[i];e.call(r,s,i,t)&&a.push(s)}return a}function isObject(t){return null!=t&&"[object Object]"==Object.prototype.toString.call(t)}function isEmptyObject(t){if(isObject(t)){for(var e in t)if(hasOwnProperty.call(t,e))return!1;return!0}return!1}function isArray(t){return!!t&&"[object Array]"===Object.prototype.toString.call(t)}function isString(t){return"[object String]"==Object.prototype.toString.call(t)}function isDate(t){return"[object Date]"==Object.prototype.toString.call(t)}function isBoolean(t){return"[object Boolean]"==Object.prototype.toString.call(t)}function isNumber(t){return"[object Number]"==Object.prototype.toString.call(t)&&/[\d\.]+/.test(String(t))}function isFunction(t){if(!t)return!1;var e=Object.prototype.toString.call(t);return"[object Function]"==e||"[object AsyncFunction]"==e}function getURLSearchParams(t){for(var e=function(t){return decodeURIComponent(t)},r={},a=(t||"").split("&"),i=0;i<a.length;i++){var s=a[i].indexOf("=");if(-1!==s){var n=a[i].substring(0,s),o=a[i].substring(s+1);n=e(n),o=e(o),r[n]=o}}return r}function log(){if("object"==typeof console&&console.log){isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]);try{return console.log.apply(console,arguments)}catch(t){console.log("sensorsabtest————",arguments[0])}}}function isJSONString(t){try{JSON.parse(t)}catch(t){return!1}return!0}function getQueryParam(t,e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),t=decodeURIComponent(t);var r=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null===r||r&&"string"!=typeof r[1]&&r[1].length?"":decodeURIComponent(r[1])}function decodeURIComponent(t){var e=t;try{e=decodeURIComponent(t)}catch(r){e=t}return e}function formatSystem(t){var e=t.toLowerCase();return"ios"===e?"iOS":"android"===e?"Android":t}function validTimeout(t){return t.timeout_milliseconds&&isNumber(t.timeout_milliseconds)||(t.timeout_milliseconds=3e3),t.timeout_milliseconds<200&&(t.timeout_milliseconds=200),t}function indexOf(t,e){var r=t.indexOf;if(r)return r.call(t,e);for(var a=0;a<t.length;a++)if(e===t[a])return a;return-1}function rot13obfs(t,e){e="number"==typeof e?e:13;for(var r=(t=String(t)).split(""),a=0,i=r.length;a<i;a++){r[a].charCodeAt(0)<126&&(r[a]=String.fromCharCode((r[a].charCodeAt(0)+e)%126))}return r.join("")}function rot13defs(t){return rot13obfs(t=String(t),113)}function formatDate(t){function e(t){return t<10?"0"+t:t}return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+"."+e(t.getMilliseconds())}function getRelativeValue(t,e){var r={},a={INTEGER:function(t){var e=parseFloat(t);isNaN(e)?_.log("\u539f\u59cb\u6570\u636e INTEGER \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t):(r.value=e,r.type="Number")},STRING:function(t){_.isString(t)?(r.value=t,r.type="String"):_.log("\u539f\u59cb\u6570\u636e STRING \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t)},JSON:function(t){if(_.isJSONString(t)){var e=JSON.parse(t);_.isObject(e)?(r.value=e,r.type="Object"):_.log("\u539f\u59cb\u6570\u636e JSON \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t)}},BOOLEAN:function(t){"true"===t?(r.value=!0,r.type="Boolean"):"false"===t?(r.value=!1,r.type="Boolean"):_.log("\u539f\u59cb\u6570\u636e BOOLEAN \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t)}};try{a[e]?a[e](t):_.log("\u8bd5\u9a8c\u6570\u636e\u7c7b\u578b\u89e3\u6790\u5931\u8d25",e,t)}catch(r){_.log(r,t,e)}return r}var _={extend:extend,each:each,filter:filter,isObject:isObject,isEmptyObject:isEmptyObject,isArray:isArray,isString:isString,isDate:isDate,isBoolean:isBoolean,isNumber:isNumber,isFunction:isFunction,getURLSearchParams:getURLSearchParams,log:log,isJSONString:isJSONString,getQueryParam:getQueryParam,decodeURIComponent:decodeURIComponent,formatSystem:formatSystem,validTimeout:validTimeout,indexOf:indexOf,rot13obfs:rot13obfs,rot13defs:rot13defs,formatDate:formatDate,getRelativeValue:getRelativeValue};function getSystemInfo(t){try{const e=wx.getSystemInfoSync();t.props.$manufacturer=e.brand,t.props.$model=e.model,t.props.$os=formatSystem(e.platform),t.props.$os_version=e.system.indexOf(" ")>-1?e.system.split(" ")[1]:e.system}catch(t){log("get system fails")}}function getAppId(){var t;if(wx.getAccountInfoSync&&(t=wx.getAccountInfoSync()),isObject(t)&&isObject(t.miniProgram))return t.miniProgram.appId}_.getSystemInfo=getSystemInfo,_.getAppId=getAppId;var para={url:"",project_key:"",retry_times:3,timeout_milliseconds:3e3,update_interval:6e5},info={scene:"",lib_version:"1.20.4",platform:"MiniProgram",storage_key:"sensorsdata2015_ABTest",storage_out_list_key:"sensorsdata_abtest_out_list",storage_triggered_map_key:"sensorsdata_abtest_triggered_map",storage_out_triggered_map_key:"sensorsdata_abtest_out_triggered_map",storage_track_config_key:"sensorsdata_abtest_track_config",lib_plugin_name:"miniprogram_abtesting",platform_obj:wx,track_config:{},default_track_config:{trigger_switch:!0,property_set_switch:!1,trigger_content_ext:["abtest_experiment_version","abtest_experiment_result_id"]}},props={$manufacturer:"",$model:"",$os:"",$os_version:""},state={inited:!1,fetchInterval:null,test_list:{},out_triggered_map:{},triggered_map:{},out_list:[]};function mixinConfig(t){t.para=para,t.info=info,t.state=state,t.props=props,t.plugin_name="ABTestingWechat",t.plugin_version="1.20.4"}function mixinStore(t){var e=t.info.platform_obj;if(!e||isEmptyObject(e))return!1;t.store={getStorage:function(t){var r="";try{a=r=e.getStorageSync(t),r=isString(a)?(-1!==a.indexOf("data:enc;")&&(a=rot13defs(a=a.substring("data:enc;".length))),a):a}catch(t){log("\u83b7\u53d6 storage \u5931\u8d25\uff01")}var a;return isJSONString(r)&&(r=JSON.parse(r)),r},setStorage:function(r,a){var i;try{s=i=JSON.stringify(a),n=!1,t&&t._sa&&t._sa.para&&(n=t._sa.para.encrypt_storage),n&&(isObject(s)&&(s=JSON.stringify(s)),s="data:enc;"+rot13obfs(s)),i=s}catch(t){log("\u5e8f\u5217\u5316\u7f13\u5b58\u5bf9\u8c61\u5931\u8d25\uff01")}var s,n;try{e.setStorageSync(r,i)}catch(t){log("set Storage fail again --",t)}}}}function mixinRequest(t){var e,r=t.info.platform_obj;isObject(r)&&(e=function(t){var e=t.url,a="GET",i=null;t.method&&(a=t.method),t.data&&(i=t.data),r.request({url:e,method:a,data:i,timeout:t.timeout,success:function(e){t.suc(e.data)},fail:function(e){t.fail(e)}})}),t.request=e}function mixinFetch(t){t.fetchTest=function(){var e=0,r=!1,a=t.creatRequestData();function i(e){_.log("\u8bf7\u6c42\u6570\u636e\u7ed3\u679c\u6210\u529f: ",e),r=!0,t.updateData(e),t.state.fetchInterval&&clearTimeout(t.state.fetchInterval),t.state.fetchInterval=setTimeout(function(){t.request({url:t.para.url,method:"POST",data:JSON.stringify(a),timeout:t.para.timeout_milliseconds,suc:i,fail:s})},t.para.update_interval)}function s(n){return _.log("\u8bf7\u6c42\u6570\u636e\u7ed3\u679c\u5931\u8d25: ",n),e++,!r&&e<t.para.retry_times&&setTimeout(function(){t.request({url:t.para.url,method:"POST",data:JSON.stringify(a),timeout:t.para.timeout_milliseconds,suc:i,fail:s})},3e3),!1}t.request({url:t.para.url,method:"POST",data:JSON.stringify(a),timeout:t.para.timeout_milliseconds,suc:i,fail:s})},t.updateData=function(e){var r=e.results;t.resolveData(r),t.store.setStorage(t.info.storage_key,t.state.test_list),_.log("\u66f4\u65b0\u8bd5\u9a8c\u6570\u636e")},t.resolveData=function(e){if(!_.isArray(e))return _.log("\u89e3\u6790——\u6570\u636e\u683c\u5f0f\u9519\u8bef",e),!1;t.state.test_list={},_.each(e,function(e){_.isObject(e)&&e.variables&&_.isArray(e.variables)&&_.each(e.variables,function(r){_.isObject(r)&&!t.state.test_list[r.name]&&(t.state.test_list[r.name]={abtest_experiment_id:e.abtest_experiment_id,abtest_experiment_group_id:e.abtest_experiment_group_id,is_control_group:e.is_control_group,is_white_list:e.is_white_list,config:_.getRelativeValue(r.value,r.type)})})})},t.creatRequestData=function(e){var r=function(){var e={};if(!t._sa||!t._sa.store)return e;var r=t._sa.store.getFirstId(),a=t._sa.store.getDistinctId();r?(e.login_id=a,e.anonymous_id=r):e.anonymous_id=a;return e}(),a={anonymous_id:r.anonymous_id,platform:t.info.platform,abtest_lib_version:t.info.lib_version,properties:{$is_first_day:t._sa._.getIsFirstDay()}};if(t.info.scene&&(a.properties.$latest_scene=t.info.scene),r.login_id&&(a.login_id=r.login_id),t._sa._&&t._sa._.info&&t._sa._.info.currentProps)var i=t._sa._.info.currentProps.$latest_scene;return i&&(a.properties.$latest_scene=i),a.properties=_.extend({},a.properties,t.props),_.isObject(e)&&_.isObject(e.properties)&&(a.properties=_.extend({},a.properties,e.properties)),_.isObject(e)&&_.isObject(e.custom_properties)&&(a.custom_properties=_.extend({},e.custom_properties),a.param_name=e.param_name),a}}function mixinFetch$1(t){mixinFetch(t),t.registerProperty=function(){if(t.info.track_config.property_set_switch){var e=t._sa.store.getUnionId(),r="USER"+(e.login_id||e.anonymous_id),a="DEVICE"+e.anonymous_id,i=[],s=[],n=t.state.triggered_map;_.each(n,function(t,e){e!=r&&e!==a||_.isArray(t)&&_.each(t,function(t){t.result_id&&i.push(t.result_id)})}),_.isObject(t.state.test_list)&&_.each(t.state.test_list,function(t){var e=t.abtest_experiment_result_id;e&&s.indexOf(e)<0&&s.push(e)}),i.length>0&&t._sa.registerApp({abtest_result:i}),s.length>0&&t._sa.registerApp({abtest_dispatch_result:s})}else t._sa.clearAppRegister(["abtest_result","abtest_dispatch_result"])},t.saveData=function(){t.store.setStorage(t.info.storage_key,t.state.test_list),t.store.setStorage(t.info.storage_out_list_key,t.state.out_list),t.store.setStorage(t.info.storage_track_config_key,t.info.track_config)},t.updateData=function(e){t.resolveData(e),t.saveData(),_.log("\u66f4\u65b0\u8bd5\u9a8c\u6570\u636e"),t.registerProperty()},t.resolveData=function(e){if(!_.isObject(e)||!_.isArray(e.results))return _.log("\u89e3\u6790——\u6570\u636e\u683c\u5f0f\u9519\u8bef",e),!1;var r=e.results;t.state.test_list={},_.isArray(r)&&_.each(r,function(e){_.isObject(e)&&e.variables&&_.isArray(e.variables)&&_.each(e.variables,function(r){_.isObject(r)&&!t.state.test_list[r.name]&&(t.state.test_list[r.name]=_.extend({},e),t.state.test_list[r.name].config=_.getRelativeValue(r.value,r.type))})}),t.state.out_list=_.isArray(e.out_list)?e.out_list:[],t.info.track_config=_.isObject(e.track_config)?e.track_config:t.info.default_track_config}}var VALUE_TYPE_LIST=["Number","String","Object","Boolean"],regName=/^((?!^distinct_id$|^original_id$|^time$|^properties$|^id$|^first_id$|^second_id$|^users$|^events$|^event$|^user_id$|^date$|^datetime$|^user_tag.*|^user_group.*)[a-zA-Z_][a-zA-Z\d_]*)$/i,verifyStore={valueType:function(t,e){switch(e){case"Number":if(_.isNumber(t))return!0;break;case"String":if(_.isString(t))return!0;break;case"Object":if(_.isObject(t))return!0;break;case"Boolean":if(!0===t||!1===t)return!0;break;default:return!1}return!1},para:function(t,e,r){var a=!0;return _.each(r,function(r){switch(r){case"param_name":e.param_name&&_.isString(e.param_name)&&e.param_name.length>0||(_.log(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cparam_name\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e\uff01param_name:",e.param_name),a=!1);break;case"value_type":_.isString(e.value_type)&&-1!==_.indexOf(VALUE_TYPE_LIST,e.value_type)||(_.log(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cvalue_type\u914d\u7f6e\u9519\u8bef",e.value_type),a=!1);break;case"default_value":void 0===e.default_value?(_.log(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u53c2\u6570\u672a\u914d\u7f6e"),a=!1):verifyStore.valueType(e.default_value,e.value_type)||(_.log(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u7c7b\u578b\u5fc5\u987b\u4e0evalue_type\u4e00\u81f4\uff01",e.default_value,e.value_type),a=!1);break;case"callback":_.isFunction(e.callback)||(_.log(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0ccallback\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),a=!1)}}),a},resolveCustomProperties:function(t){var e={verify_success:!0,para:null},r=t.custom_properties;if(!_.isObject(r)||_.isEmptyObject(r))return delete t.custom_properties,e.para=t,e;if(_.each(r,function(t,r){if((!_.isString(r)||!regName.test(r)||r.length>100)&&(_.log(" property name [ "+r+" ] is not invalid "),e.verify_success=!1),(_.isString(t)||_.isNumber(t)||_.isBoolean(t)||_.isArray(t)||_.isDate(t))&&!(_.isString(t)&&t.length>500)||(_.log("property [ "+r+" ] of value [ "+JSON.stringify(t)+" ] is not invalid"),e.verify_success=!1),_.isArray(t)){var a=!0;_.each(t,function(t){!1!==a&&(_.isString(t)||(a=!1))}),a||(_.log("property  value type can be array, but only allow string item. property [ "+r+" ] of value  "+JSON.stringify(t)+"  is not invalid"),e.verify_success=!1)}}),!0===e.verify_success){var a={};_.each(r,function(t,e){_.isDate(t)?a[e]=_.formatDate(t):_.isString(t)?a[e]=t:a[e]=JSON.stringify(t)}),t.custom_properties=a}return e.para=t,e}};function defineApi(t,e){for(var r of e)t[r]="fetchCacheABTest"===r?function(t){if(_.log("\u8c03\u7528\u5206\u6d41 API --- A/B Testing \u63d2\u4ef6\u5c1a\u672a\u521d\u59cb\u5316\uff01"),Object.prototype.hasOwnProperty.call(t,"default_value"))return t.default_value}:function(t){_.log("\u8c03\u7528\u5206\u6d41 API --- A/B Testing \u63d2\u4ef6\u5c1a\u672a\u521d\u59cb\u5316\uff01"),t&&_.isFunction(t.callback)&&Object.prototype.hasOwnProperty.call(t,"default_value")&&t.callback(t.default_value)}}function initAPI(t){t.setPara=function(e){if(!_.isString(e.url)||"http"!==e.url.slice(0,4))return _.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1;t.para.url=e.url;var r=_.getQueryParam(e.url,"project-key");return r?(t.para.project_key=r,_.isNumber(e.timeout_milliseconds)&&(e.timeout_milliseconds<200?t.para.timeout_milliseconds=200:t.para.timeout_milliseconds=e.timeout_milliseconds),_.isNumber(e.update_interval)&&(t.para.update_interval=e.update_interval),!0):(_.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff08\u5fc5\u987b\u5305\u542b project-key\uff09\uff01"),!1)},t.asyncFetchABTest=function(e){if(!_.isObject(e))return _.log("asyncFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;if(!verifyStore.para("asyncFetchABTest",e,["param_name","value_type","default_value","callback"]))return!1;var r=verifyStore.resolveCustomProperties(e);r.verify_success?(e=r.para,_.validTimeout(e),t.asyncFetch(e)):e.callback(e.default_value)},t.fastFetchABTest=function(e){if(!_.isObject(e))return _.log("fastFetchABTest \u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;if(!verifyStore.para("fastFetchABTest",e,["param_name","value_type","default_value","callback"]))return!1;var r=verifyStore.resolveCustomProperties(e);if(r.verify_success){e=r.para,_.validTimeout(e);var a=t.searchLocalExp(e.param_name);if(_.isObject(a)){var i=t.getExpResult(e,a);e.callback(i)}else _.log("fastFetchABTest \u7f13\u5b58\u4e2d\u672a\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u53d1\u8d77\u8bf7\u6c42"),t.asyncFetch(e)}else e.callback(e.default_value)},t.fetchCacheABTest=function(e){if(_.isObject(e))return!!verifyStore.para("fetchCacheABTest",e,["param_name","value_type","default_value"])&&t.getExpResult(e);_.log("fetchCacheABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e")},t.asyncFetch=function(e){t.getResultFromServer({para:e,suc:function(r){if(_.isObject(r)&&"SUCCESS"===r.status){_.log("\u83b7\u53d6\u5230\u670d\u52a1\u7aef\u8bd5\u9a8c\u7ed3\u679c\u6570\u636e: ",r),t.updateData(r);var a=t.getExpResult(e);e.callback(a)}else e.callback(e.default_value)},fail:function(t){_.log("\u83b7\u53d6\u670d\u52a1\u7aef\u6570\u636e\u5931\u8d25: ",t),e.callback(e.default_value)}})},t.searchLocalExp=function(e){return!!t.state.test_list[e]&&t.state.test_list[e]},t.getExpResult=function(e,r){var a=e.default_value,i=r||t.searchLocalExp(e.param_name);return _.isObject(i)?_.isObject(i.config)&&(i.config.type===e.value_type?(a=i.config.value,t.trackTestTrigger(i)):_.log("\u8bd5\u9a8c\u7ed3\u679c\u7c7b\u578b\u4e0e\u671f\u671b\u7c7b\u578b\u4e0d\u4e00\u81f4\uff0cparam_name\uff1a"+e.param_name+"\uff0c\u5f53\u524d\u8fd4\u56de\u7c7b\u578b\u4e3a\uff1a"+i.config.type+"\uff0c\u671f\u671b\u7c7b\u578b\u4e3a\uff1a"+e.value_type)):_.log("\u672c\u5730\u672a\u67e5\u8be2\u5230\u8bd5\u9a8c\u6570\u636e\uff0c\u8bd5\u9a8c\u53c2\u6570\u540d\u79f0\uff1a"+e.param_name),a},t.getResultFromServer=function(e){var r=(e=_.isObject(e)?e:{}).para||{},a=e.suc,i=e.fail,s=t.creatRequestData(r);t.request({url:t.para.url,method:"POST",data:JSON.stringify(s),contentType:"application/json",timeout:r.timeout_milliseconds||t.para.timeout_milliseconds,suc:a,fail:i}),_.log("\u5411\u670d\u52a1\u7aef\u53d1\u8d77\u8bd5\u9a8c\u8bf7\u6c42")}}function mixinAPI(t){initAPI(t);var e=t.getExpResult;t.getExpResult=function(r,a){var i=e(r,a);return t.trackOutTestTrigger(r),i}}function formatTriggerStorage(t){var e=t.state.triggered_map;if(!_.isEmptyObject(e)){var r={},a=!1;_.each(e,function(t,e){_.isArray(t)?r[e]=t:(a=!0,r[e]=[],_.isObject(t)&&_.each(t,function(t,a){r[e].push({abtest_experiment_id:a,group_id:t})}))}),a&&(t.state.triggered_map=r,t.store.setStorage(t.info.storage_triggered_map_key,r))}}function mixinTrack(t){function e(e,r){var a=function(e){var r=t._sa.store.getDistinctId();return e.subject_id&&e.subject_name&&(r=e.subject_name+e.subject_id),r}(r),i=t.info.track_config.trigger_switch,s=!0,n=t.state[e];n&&_.isObject(n)&&n[a]&&_.each(n[a],function(t){t.experiment_id===r.abtest_experiment_id&&t.group_id===r.abtest_experiment_group_id&&t.result_id===r.abtest_experiment_result_id&&(s=!1)}),t.state[e][a]=function(t,e){var r=[],a=e.abtest_experiment_id;if(_.isString(a)){var i={experiment_id:a,group_id:e.abtest_experiment_group_id,result_id:e.abtest_experiment_result_id};if(t&&_.isArray(t)){var s=!1;_.each(t,function(e,r){e.experiment_id===a&&(t.splice(r,1,i),s=!0)}),s||t.push(i)}else t=[i];r=t}return r}(n[a],r),t.store.setStorage(t.info.storage_triggered_map_key,t.state.triggered_map),t.store.setStorage(t.info.storage_out_triggered_map_key,t.state.out_triggered_map),t.registerProperty(a);var o=function(e){var r={},a=t.state.triggered_map;if("{}"!==JSON.stringify(a)){var i=t.info.lib_plugin_name+":"+t.info.lib_version;r.$lib_plugin_version=[i]}var s={$abtest_experiment_id:e.abtest_experiment_id,$abtest_experiment_group_id:e.abtest_experiment_group_id},n=t.info.track_config.trigger_content_ext;return _.each(n,function(t){void 0!==e[t]&&(r["$"+t]=e[t])}),r=_.extend(s,r)}(r);return s&&i&&t._sa.track("$ABTestTrigger",o),s}t.trackTestTrigger=function(r){if(r.is_white_list)return!1;formatTriggerStorage(t),e("triggered_map",r)},t.trackOutTestTrigger=function(r){var a=t.state.out_list,i=!1,s={};_.isArray(a)&&a.length>0&&(_.each(a,function(t){_.isObject(t)&&!i&&_.isObject(t)&&t.variables&&_.isArray(t.variables)&&_.each(t.variables,function(e){var a=_.getRelativeValue(e.value,e.type);!i&&a&&_.isObject(e)&&r.param_name===e.name&&a.type===r.value_type&&(i=!0,s=t)})}),i&&e("out_triggered_map",s))}}var ABTest={};mixinConfig(ABTest),mixinFetch$1(ABTest),mixinTrack(ABTest),mixinRequest(ABTest),mixinStore(ABTest),ABTest.init=function(t,e){if(_.log("\u521d\u59cb\u5316 ABTest \u63d2\u4ef6"),this.state.inited)return!1;if(mixinAPI(ABTest),!this.setPara(e))return!1;var r,a,i,s,n;this.state.inited=!0,this._sa=t,this.subId=new t.eventSub(this.handleIdChange),r=ABTest.store.getStorage(ABTest.info.storage_key),a=ABTest.store.getStorage(ABTest.info.storage_out_list_key),i=ABTest.store.getStorage(ABTest.info.storage_triggered_map_key),s=ABTest.store.getStorage(ABTest.info.storage_out_triggered_map_key),n=ABTest.store.getStorage(ABTest.info.storage_track_config_key),ABTest.state.test_list=_.isObject(r)?r:{},ABTest.state.out_list=_.isArray(a)?a:[],ABTest.state.triggered_map=_.isObject(i)?i:{},ABTest.state.out_triggered_map=_.isObject(s)?s:{},ABTest.info.track_config=_.isObject(n)?n:ABTest.info.default_track_config,ABTest.registerProperty(),_.getSystemInfo(this),this.subId.isReady(),this.listenAppLaunch()},ABTest.handleIdChange=function(t){"changeDistinctId"===t&&(ABTest.state.test_list={},ABTest.state.out_list=[],ABTest.info.track_config=ABTest.info.default_track_config,ABTest.saveData(),ABTest.fetchTest())},ABTest.listenAppLaunch=function(){var t=wx.getLaunchOptionsSync();t&&t.scene&&(this.info.scene="wx-"+t.scene),this.fetchTest()},defineApi(ABTest,["asyncFetchABTest","fastFetchABTest","fetchCacheABTest"]),module.exports=ABTest;