function e(t,e,n){if(t[e]){var r=t[e];t[e]=function(t){n.call(this,t,e),r.call(this,t)}}else t[e]=function(t){n.call(this,t,e)}}function appLaunch(){this[sa.para.name]=sa,sa.init()}function appShow(){}function appHide(t,e){}function pageOnunload(t,e){}function pageOnload(t,e){}function pageOnshow(t,e){var n="string"==typeof this.__route__?this.__route__:"系统没有取到值";sa.para.onshow?sa.para.onshow(sa,n,this):sa.track("$MPViewScreen",{$url:n})}var _={},sa={};sa.para=require("sensorsdata_conf.js"),sa._queue=[],sa.getSystemInfoComplete=!1;var ArrayProto=Array.prototype,FuncProto=Function.prototype,ObjProto=Object.prototype,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,LIB_VERSION="0.2",LIB_NAME="MiniProgram";sa.lib_version=LIB_VERSION;var logger="object"==typeof logger?logger:{};logger.info=function(){if("object"==typeof console&&console.log)try{return console.log.apply(console,arguments)}catch(t){console.log(arguments[0])}},function(){var t=(FuncProto.bind,ArrayProto.forEach),e=ArrayProto.indexOf,n=Array.isArray,r={},i=_.each=function(e,n,i){if(null==e)return!1;if(t&&e.forEach===t)e.forEach(n,i);else if(e.length===+e.length){for(var o=0,a=e.length;a>o;o++)if(o in e&&n.call(i,e[o],o,e)===r)return!1}else for(var s in e)if(hasOwnProperty.call(e,s)&&n.call(i,e[s],s,e)===r)return!1};_.logger=logger,_.extend=function(t){return i(slice.call(arguments,1),function(e){for(var n in e)void 0!==e[n]&&(t[n]=e[n])}),t},_.extend2Lev=function(t){return i(slice.call(arguments,1),function(e){for(var n in e)void 0!==e[n]&&(_.isObject(e[n])&&_.isObject(t[n])?_.extend(t[n],e[n]):t[n]=e[n])}),t},_.coverExtend=function(t){return i(slice.call(arguments,1),function(e){for(var n in e)void 0!==e[n]&&void 0===t[n]&&(t[n]=e[n])}),t},_.isArray=n||function(t){return"[object Array]"===toString.call(t)},_.isFunction=function(t){try{return/^\s*\bfunction\b/.test(t)}catch(e){return!1}},_.isArguments=function(t){return!(!t||!hasOwnProperty.call(t,"callee"))},_.toArray=function(t){return t?t.toArray?t.toArray():_.isArray(t)?slice.call(t):_.isArguments(t)?slice.call(t):_.values(t):[]},_.values=function(t){var e=[];return null==t?e:(i(t,function(t){e[e.length]=t}),e)},_.include=function(t,n){var o=!1;return null==t?o:e&&t.indexOf===e?-1!=t.indexOf(n):(i(t,function(t){return o||(o=t===n)?r:void 0}),o)}}(),_.trim=function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},_.isObject=function(t){return"[object Object]"==toString.call(t)&&null!=t},_.isEmptyObject=function(t){if(_.isObject(t)){for(var e in t)if(hasOwnProperty.call(t,e))return!1;return!0}return!1},_.isUndefined=function(t){return void 0===t},_.isString=function(t){return"[object String]"==toString.call(t)},_.isDate=function(t){return"[object Date]"==toString.call(t)},_.isBoolean=function(t){return"[object Boolean]"==toString.call(t)},_.isNumber=function(t){return"[object Number]"==toString.call(t)&&/[\d\.]+/.test(String(t))},_.isJSONString=function(t){try{JSON.parse(t)}catch(e){return!1}return!0},_.decodeURIComponent=function(t){var e="";try{e=decodeURIComponent(t)}catch(n){e=t}return e},_.encodeDates=function(t){return _.each(t,function(e,n){_.isDate(e)?t[n]=_.formatDate(e):_.isObject(e)&&(t[n]=_.encodeDates(e))}),t},_.formatDate=function(t){function e(t){return 10>t?"0"+t:t}return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+"."+e(t.getMilliseconds())},_.searchObjDate=function(t){_.isObject(t)&&_.each(t,function(e,n){_.isObject(e)?_.searchObjDate(t[n]):_.isDate(e)&&(t[n]=_.formatDate(e))})},_.formatString=function(t){return t.length>sa.para.max_string_length?(logger.info("字符串长度超过限制，已经做截取--"+t),t.slice(0,sa.para.max_string_length)):t},_.searchObjString=function(t){_.isObject(t)&&_.each(t,function(e,n){_.isObject(e)?_.searchObjString(t[n]):_.isString(e)&&(t[n]=_.formatString(e))})},_.unique=function(t){for(var e,n=[],r={},i=0;i<t.length;i++)e=t[i],e in r||(r[e]=!0,n.push(e));return n},_.strip_sa_properties=function(t){return _.isObject(t)?(_.each(t,function(e,n){if(_.isArray(e)){var r=[];_.each(e,function(t){_.isString(t)?r.push(t):logger.info("您的数据-",e,"的数组里的值必须是字符串,已经将其删除")}),0!==r.length?t[n]=r:(delete t[n],logger.info("已经删除空的数组"))}_.isString(e)||_.isNumber(e)||_.isDate(e)||_.isBoolean(e)||_.isArray(e)||(logger.info("您的数据-",e,"-格式不满足要求，我们已经将其删除"),delete t[n])}),t):t},_.strip_empty_properties=function(t){var e={};return _.each(t,function(t,n){null!=t&&(e[n]=t)}),e},_.utf8Encode=function(t){t=(t+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var e,n,r,i="",o=0;for(e=n=0,o=t.length,r=0;o>r;r++){var a=t.charCodeAt(r),s=null;128>a?n++:s=a>127&&2048>a?String.fromCharCode(a>>6|192,63&a|128):String.fromCharCode(a>>12|224,a>>6&63|128,63&a|128),null!==s&&(n>e&&(i+=t.substring(e,n)),i+=s,e=n=r+1)}return n>e&&(i+=t.substring(e,t.length)),i},_.base64Encode=function(t){var e,n,r,i,o,a,s,c,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,p=0,f="",g=[];if(!t)return t;t=_.utf8Encode(t);do e=t.charCodeAt(l++),n=t.charCodeAt(l++),r=t.charCodeAt(l++),c=e<<16|n<<8|r,i=c>>18&63,o=c>>12&63,a=c>>6&63,s=63&c,g[p++]=u.charAt(i)+u.charAt(o)+u.charAt(a)+u.charAt(s);while(l<t.length);switch(f=g.join(""),t.length%3){case 1:f=f.slice(0,-2)+"==";break;case 2:f=f.slice(0,-1)+"="}return f},_.info={properties:{$lib:LIB_NAME,$lib_version:String(LIB_VERSION),$user_agent:"SensorsAnalytics MP SDK"},getSystem:function(){function t(){wx.getNetworkType({success:function(t){n.$network_type=t.networkType},complete:e})}function e(){wx.getSystemInfo({success:function(t){n.$model=t.model,n.$screen_width=Number(t.windowWidth),n.$screen_height=Number(t.windowHeight),n.$os=t.system.split(" ")[0],n.$os_version=t.system.split(" ")[1]},complete:r.setStatusComplete})}var n=this.properties,r=this;t()},setStatusComplete:function(){sa.getSystemInfoComplete=!0,sa._queue.length>0&&(_.each(sa._queue,function(t){sa.prepareData.apply(sa,slice.call(t))}),sa._queue=[])}},sa._=_,sa.prepareData=function(t,e){if(!sa.getSystemInfoComplete)return sa._queue.push(arguments),!1;var n={distinct_id:this.store.getDistinctId(),lib:{$lib:LIB_NAME,$lib_method:"code",$lib_version:String(LIB_VERSION)},properties:{}};_.extend(n,t),_.isObject(t.properties)&&!_.isEmptyObject(t.properties)&&_.extend(n.properties,t.properties),t.type&&"profile"===t.type.slice(0,7)||(n.properties=_.extend({},_.info.properties,n.properties)),n.properties.$time&&_.isDate(n.properties.$time)?(n.time=1*n.properties.$time,delete n.properties.$time):sa.para.use_client_time&&(n.time=1*new Date),_.searchObjDate(n),_.searchObjString(n),sa.send(n,e)},sa.store={getUUID:function(){return""+Date.now()+"-"+Math.floor(1e7*Math.random())+"-"+Math.random().toString(16).replace(".","")+"-"+String(31242*Math.random()).replace(".","").slice(0,8)},setStorage:function(){},getStorage:function(){return wx.getStorageSync("sensorsdata2015_wechat")||""},_state:{},toState:function(t){var e=null;_.isJSONString(t)?(e=JSON.parse(t),e.distinct_id?this._state=e:this.set("distinct_id",this.getUUID())):this.set("distinct_id",this.getUUID())},getFirstId:function(){return this._state.first_id},getDistinctId:function(){return this._state.distinct_id},set:function(t,e){this._state=this._state||{},this._state[t]=e,this.save()},save:function(){wx.setStorageSync("sensorsdata2015_wechat",JSON.stringify(this._state))},init:function(){var t=this.getStorage();t?this.toState(t):this.set("distinct_id",this.getUUID())}},sa.setProfile=function(t,e){sa.prepareData({type:"profile_set",properties:t},e)},sa.setOnceProfile=function(t,e){sa.prepareData({type:"profile_set_once",properties:t},e)},sa.track=function(t,e,n){this.prepareData({type:"track",event:t,properties:e},n)},sa.trackSignup=function(t,e,n,r){sa.prepareData({original_id:sa.store.getFirstId()||sa.store.getDistinctId(),distinct_id:t,type:"track_signup",event:e,properties:n},r),sa.store.set("distinct_id",t)},sa.register=function(){},sa.login=function(t){var e=sa.store.getFirstId(),n=sa.store.getDistinctId();t!==n&&(e?sa.trackSignup(t,"$SignUp"):(sa.store.set("first_id",n),sa.trackSignup(t,"$SignUp")))},sa.init=function(){this._.info.getSystem(),this.store.init(),_.isObject(this.para.register)&&(_.info.properties=_.extend(_.info.properties,this.para.register))},sa.send=function(t){var e=0,n="";t._nocache=(String(Math.random())+String(Math.random())+String(Math.random())).slice(2,15),logger.info(t),t=JSON.stringify(t),n=-1!==sa.para.server_url.indexOf("?")?sa.para.server_url+"&data="+encodeURIComponent(_.base64Encode(t)):sa.para.server_url+"?data="+encodeURIComponent(_.base64Encode(t));var r=function(){wx.request({url:n,method:"GET",fail:function(){logger.info("发送错误，重新发送"),2>e&&(e++,r())}})};r()};var p=App;App=function(t){e(t,"onLaunch",appLaunch),e(t,"onShow",appShow),e(t,"onHide",appHide),p(t)};var v=Page;Page=function(t){e(t,"onLoad",pageOnload),e(t,"onUnload",pageOnunload),e(t,"onShow",pageOnshow),e(t,"onHide",pageOnunload),v(t)},module.exports=sa;