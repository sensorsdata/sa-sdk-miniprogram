"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty;function isFunction(e){if(!e)return!1;var t=Object.prototype.toString.call(e);return"[object Function]"==t||"[object AsyncFunction]"==t}function isObject(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)}function isString(e){return"[object String]"==toString.call(e)}function log(){if("object"==typeof console&&console.log){isString(arguments[0])&&(arguments[0]="sensors registerProperties————"+arguments[0]);try{return console.log.apply(console,arguments)}catch(e){console.log("sensors registerProperties————",arguments[0])}}}function extend(e){return each(Array.prototype.slice.call(arguments,1),function(t){for(var r in t)void 0!==t[r]&&(e[r]=t[r])}),e}function each(e,t,r){var i=Array.prototype.forEach,n={};if(null==e)return!1;if(i&&e.forEach===i)e.forEach(t,r);else if(e.length===+e.length){for(var s=0,o=e.length;s<o;s++)if(s in e&&t.call(r,e[s],s,e)===n)return!1}else for(var c in e)if(hasOwnProperty.call(e,c)&&t.call(r,e[c],c,e)===n)return!1}var _sa,sa,_={isFunction:isFunction,isObject:isObject,extend:extend,log:log,each:each},RegisterProperties={version:"props_sdk_version"},register_list=[];function onEventSend(){_sa.ee.sdk.on("createData",function(e){if(_.isObject(e)&&"track"===e.type&&_.isObject(e.properties)){var t=getRegisterProperties(e);e=Object.assign(e.properties,t)}})}function getRegisterProperties(e){var t={};return _.each(register_list,function(r){var i={};_.isFunction(r)?i=r({event:e.event,properties:e.properties,data:e}):-1!==r.events.indexOf(e.event)&&(i=r.properties);t=Object.assign(t,i)}),_.isObject(t)?t:{}}RegisterProperties.init=function(e){if(!e||!_.isObject(e))return _.log("\u8bf7\u4f20\u5165\u6b63\u786e\u7684 sensors \u5bf9\u8c61\uff01"),!1;_sa=e,onEventSend()},RegisterProperties.register=function(e){e&&_.isObject(e)?e.properties&&_.isObject(e.properties)&&e.events&&e.events.length>0&&register_list.push(e):_.log("\u53c2\u6570\u9519\u8bef\uff01")},RegisterProperties.hookRegister=function(e){_.isFunction(e)&&register_list.push(e)};var setReferrerPath={name:"sa-set-referrer-path",init:function(e){if(!(sa=e))return console.log("\u5f53\u524d\u4e3bsdk \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f20\u5165\u6b63\u786e\u7684 sensors \u5bf9\u8c61\uff01"),!1;this.setRefPath()},setRefPath:function(){RegisterProperties.init(sa),RegisterProperties.hookRegister(function(e){var t="",r={};if(e&&e.properties&&(t=e.properties.$referrer||"",sa._.isString(t))){var i=t.indexOf("?");r={referrer_path:i>0?t.substring(0,i):t}}return r})}};module.exports=setReferrerPath;