var hasOwnProperty=Object.prototype.hasOwnProperty;function isFunction(e){if(!e)return!1;var t=Object.prototype.toString.call(e);return"[object Function]"==t||"[object AsyncFunction]"==t}function isObject(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)}function isString(e){return"[object String]"==toString.call(e)}function log(){if("object"==typeof console&&console.log){isString(arguments[0])&&(arguments[0]="sensors registerProperties————"+arguments[0]);try{return console.log.apply(console,arguments)}catch(e){console.log("sensors registerProperties————",arguments[0])}}}function extend(e){return each(Array.prototype.slice.call(arguments,1),function(t){for(var n in t)void 0!==t[n]&&(e[n]=t[n])}),e}function each(e,t,n){var i=Array.prototype.forEach,r={};if(null==e)return!1;if(i&&e.forEach===i)e.forEach(t,n);else if(e.length===+e.length){for(var s=0,a=e.length;s<a;s++)if(s in e&&t.call(n,e[s],s,e)===r)return!1}else for(var o in e)if(hasOwnProperty.call(e,o)&&t.call(n,e[o],o,e)===r)return!1}var sa,_={isFunction:isFunction,isObject:isObject,extend:extend,log:log,each:each},RegisterProperties={status:!1,version:"props_sdk_version"},register_list=[];function onEventSend(e){var t=RegisterProperties._sa;return _.isObject(e)&&"track"===e.type?(t._.info&&t.store&&_.isFunction(t.store.getProps)&&(e.properties=_.extend({},t._.info.properties,t.store.getProps(),t._.info.currentProps,e.properties)),getRegisterProperties(e)):{}}function getRegisterProperties(e){var t={};return _.each(register_list,function(n){var i={};if(_.isFunction(n))i=n({event:e.event,properties:e.properties,data:e});else-1!==n.events.indexOf(e.event)&&(i=n.properties);t=Object.assign(t,i)}),_.isObject(t)?t:{}}RegisterProperties.init=function(e){if(!e||!_.isObject(e))return _.log("\u8bf7\u4f20\u5165\u6b63\u786e\u7684 sensors \u5bf9\u8c61\uff01"),!1;if(RegisterProperties._sa=e,e.kit&&_.isObject(e.kit)){var t=e.kit.onEventSend;e.kit.onEventSend=function(n){var i=t(n),r=onEventSend(n);return e._.extend(i,r)}}RegisterProperties.status=!0},RegisterProperties.register=function(e){e&&_.isObject(e)?e.properties&&_.isObject(e.properties)&&e.events&&e.events.length>0&&register_list.push(e):_.log("\u53c2\u6570\u9519\u8bef\uff01")},RegisterProperties.hookRegister=function(e){_.isFunction(e)&&register_list.push(e)};var customEventList=[],maxSaveTime=2592e6,latestEventInitialTime=null;function decodeURI(e){var t="";try{t=decodeURIComponent(e)}catch(n){t=e}return t}function getQueryString(e,t){if(e[t])return decodeURI(e[t]);var n=e.scene||"";if(n){var i=decodeURI(n),r=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),s=i.match(r);if(null!==s)return decodeURI(s[2])}return null}function isSatCfLegal(e){return""!==e&&"''"!==e&&'""'!==e}var AdChannel={name:"sa-ad-channel",init:function(e){if(!(sa=e))return console.log("\u5f53\u524d\u4e3bsdk \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f20\u5165\u6b63\u786e\u7684 sensors \u5bf9\u8c61\uff01"),!1;sa.usePlugin(RegisterProperties),this.eventList.init(),this.listenAppLaunch(),this.addIsChannelCallbackEvent()},getChannelQuery:function(e){var t=sa._.deepCopy(e).query;if(sa._.isObject(t)){var n=getQueryString(t,"sat_cf"),i=isSatCfLegal(n);if(n&&i){var r={};e.scene?r.$scene=sa._.getMPScene(e.scene):r.$scene="\u672a\u53d6\u5230\u503c";var s=t.scene||"",a="";s&&(a=decodeURI(s),delete t.scene);var o=sa._.setQuery(t);if(a&&(o+=(o?"&":"")+a),e.path){r.$url_path=sa._.getPath(e.path),r.$title=sa._.getPageTitle(e.path);var c=o?"?"+o:"";r.$url=r.$url_path+c}t._sfs&&(r.$sf_source=t._sfs,r.$latest_sf_source=r.$sf_source);var l=sa._.setUtm(e,r);sa._.setLatestChannel(l.pre2),r.$latest_scene=r.$scene,r.$url_query=o,this.trackChannel(r)}}},trackChannel:function(e){sa.track("$ChannelLinkReaching",e),this.setEventQueue()},setEventQueue:function(){var e,t=[];try{for(var n=0;n<sa.initialState.queue.length;n++)if("appLaunch"===sa.initialState.queue[n][0]){e=n;break}sa._.isNumber(e)&&sa._.each(sa.initialState.queue,function(e,n){"track"===e[0]&&e[1]&&"$ChannelLinkReaching"===e[1][0]&&0!==n&&(t=e,sa.initialState.queue.splice(n,1))}),t.length>0&&sa.initialState.queue.splice(e,0,t)}catch(e){sa._.logger.info("\u6e20\u9053\u63d2\u4ef6\u4e8b\u4ef6\u53d1\u9001\u6392\u5e8f: "+e)}},addIsChannelCallbackEvent:function(){var e=this,t=["$MPLaunch","$ABTestTrigger","$PlanPopupDisplay","$PlanPopupClick","$ChannelLinkReaching","$MPShow","$MPHide","$MPViewScreen","$MPClick","$MPShare","$MPAddFavorites","$MPPageLeave","$SignUp","$UnbindID","$BindID"];RegisterProperties.hookRegister(function(n){var i={};if(n&&n.event){var r=n.event,s=!0;t.indexOf(r)<0&&(e.eventList.hasEvent(r)?s=!1:e.eventList.add(r),i.$is_channel_callback_event=s)}return i})},eventList:{init:function(){var e=sa._.getStorageSync("saminiprogramchannel"),t=(new Date).getTime();if(e&&sa._.isNumber(e.latest_event_initial_time)&&sa._.isArray(e.event_list)){var n=t-e.latest_event_initial_time;n>0&&n<maxSaveTime?(customEventList=e.event_list,latestEventInitialTime=e.latest_event_initial_time):this.reset()}else this.reset()},add:function(e){customEventList.push(e),this.save()},save:function(){var e={event_list:customEventList,latest_event_initial_time:latestEventInitialTime};sa._.setStorageSync("saminiprogramchannel",e)},reset:function(){customEventList=[],latestEventInitialTime=(new Date).getTime(),this.save()},hasEvent:function(e){var t=!1;return sa._.each(customEventList,function(n){n===e&&(t=!0)}),t}},listenAppLaunch:function(e,t){var n=wx.getLaunchOptionsSync()||{};n&&AdChannel.getChannelQuery(n)}};export default AdChannel;